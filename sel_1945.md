-------------------------------------------------------------------------------
created	;	Fri Dec 27 15:18:00 CST 2024

date	:	.

[[ipmitool]]
[[sel]]
[ref](http://sd20-server.aewin.com/Chin_Chiang/lovecodingqueen_sop/-/blob/master/sel_1945.md)

-------------------------------------------------------------------------------

# SEL #
這裡筆者要說明 在用SEL的幾個項目 與要   ~~筆者突然忘記要寫甚麼內容了.....~~

筆者這裡有看
`IPMI Intelligent Platform Management Interface Specification Second Generation v2.0 Document Revision 1.1 October 1,2013 April 21,2015 E7 Markup`
~~也太長了八.... 但是這就是 英文與中文的差別~~

首先筆者在單純的文件看不到SEL 的類別的部分(可能比者的能力稀薄...)
(所以筆者是用 code 的方式把所有 sel  的分類找到 再從這些分類中開始推到SRC中)

首先先我是用src來看前任寫的FUNCTION 再從這裡開始慢慢一點點滲透

```c			================start================
uint32_t IPMI_ADD_SEL_ENTRY(uint32_t timestamp, uint16_t sensor_info, uint32_t event_info, int32_t BMC_No)

IPMI_ADD_SEL_ENTRY(0x00, 0xD107, 0x6F8F0100, 1);
//                         │ │     │
//  ┌──────────────────────┘ │     │
//  │                        │     │
//  │                        │     │
//┌───────────────┬─────────────┬───────────┐
//│ D1            │ 07          │ 6F        │
//│───────────────┼─────────────┼───────────│
//│ sensor number │ sensor type │ event DIR │
//└───────────────┴─────────────┴───────────┘
//D1 -> sensor number -> it can random
//07 -> sensor type
//6F -> event DIR (6F ->assert EF -> deassert)

```

> In simpler terms, "asserting" means activating or triggering a particular signal or condition.
> This is a crucial part of how BMCs monitor and manage hardware components,
> ensuring that any issues are promptly detected and addressed.
>
> [reference] : bingGPT


在07的時候有問過彼大地
他說07是 event type
~~只會接受不會思考是奴隸~~

## sel-record-formats ##
這時候請看 specification 460P 32.SEL record formats
| Byte | Field                 | Description                               |
|:----:|:---------------------:|:-----------------------------------------:|
| 10   | EvM Rev               | IPMI v1.5 / v2.0 Records by setting 04h   |
| 11   | sensor type           | code for sensor that generated the event  |
| 12   | sensor #              | number of sensor that generated the event |
| 13   | Event Dir\|Event Type |                                           |
| 13   | Event Dir             | event dir [7]-0b=assertion 1b=deassertion |
| 13   | Event Type            | Type of trigger for the event             |


## use ipmitool catch detail sel code ##

### decode-ipmitool-sel-raw-data ###
`/packages/common/packages/libAEWIN-src/data/sys_info/sel.c`
`uint32_t IPMI_ADD_SEL_ENTRY(uint32_t timestamp, uint16_t sensor_info, uint32_t event_info, int32_t BMC_No)`
`/packages/libipmipdk-ARM-AST2600-AST2600EVB-AMI-src/data/PDKInt.c`
`IPMI_ADD_SEL_ENTRY(0x00,0xF014,0x6F4034AE,1);`
```bash			================start================
~ # ipmitool sel save /tmp/test
IOCTL to get IP failed: -1
   3 | 02/05/2000 | 01:16:28 | Button #0xf0 | Power Button pressed | Asserted
   4 | 02/05/2000 | 01:16:28 | Button #0xf0 | Power Button pressed | Asserted
~ #  cat /tmp/test
0x04 0x14 0xf0 0x6f 0x40 0x34 0xae # Button #0xf0 Power Button pressed
0x04 0x14 0xf0 0x6f 0x40 0x34 0xae # Button #0xf0 Power Button pressed

```
| EvM Rev                          | sensor type    | sensor number | event DIR | event data1            | data 2 | data 3 |
|:--------------------------------:|:--------------:|:-------------:|:---------:|:----------------------:|:------:|:------:|
| 0x04                             | 0x14           | 0xf0          | 0x6f      | 0x40                   | 0x34   | 0xae   |
| [ref-table](#sel-record-formats) | 0x14 == botton | any           | 6f OR EF  | [data1](#event-data-1) | any    | any    |

> 可以對前面的 [表格table](#sel-record-formats)

> note : 上面所說的 any 是代表可以任意選一個數字來取代

> sensor type 筆者後面的章節會說到 [chapter](#sensor-type-list)



這裡可以看出來
0xF014 (reverse) ====>0x14 0xF0
+ event dir[7]
  + 0x6F --> assert
  + 0xEF --> deassert


-------------------------------------------------------------------------------
## sensor types vs event type ##
this is form GPT

+ **sensor type**
IPMI defines several sensor types, each monitoring different aspects of the system. Some common sensor types include1:
    + Temperature: Monitors system temperatures.
    + Voltage: Tracks voltage levels.
    + Current: Measures electrical current.
    + Fan: Monitors fan speeds.
    + Physical Security: Detects chassis intrusion and other security breaches.
    + Processor: Monitors CPU status and performance.
    + Power Supply: Tracks power supply status.
    + Memory: Monitors memory status.

+ **event type**
Event types in IPMI are used to report specific conditions or changes detected by sensors. Some examples include
    + Threshold-based Events: Triggered when sensor readings exceed predefined thresholds (e.g., temperature too high).
    + Discrete Events: Specific events like chassis intrusion or power supply failure.
    + Platform Events: General system events such as system boot, shutdown, or critical errors.

### code-my-test-collect-all-sensor-type  ###
```c			================start================
int love_switch(){
    static int love_pkdint = -1;
    love_pkdint++;
    int fn_send = 0;
    fn_send = love_pkdint%2;
    printf("%s -> (%s) : [%d] => [%d] \n",__FILE__,__func__,__LINE__,fn_send);
    return love_pkdint;
}

void AEWIN_GPIO_Interrupt_Handler(IPMI_INTInfo_T *IntInfo)
{
    printf("Get GPIO_PWRBTN_IN_N int\n");
    int tem_pwrbtn_love = love_switch();
    uint16_t sensor_info_love=0xFF00|tem_pwrbtn_love; ////OMG
    printf("LOVE QUEEN : [%6x]\n",sensor_info_love);
    printf("0x00,0x%x,6F520abc,1\n",sensor_info_love);
    IPMI_ADD_SEL_ENTRY(0x00,sensor_info_love,0x6F520abc,1);
}
```

#### sensor-type-list ####
[*back to decode sel raw data*](#decode-ipmitool-sel-raw-data)

| change | des                            |
|:------:|:------------------------------:|
| 0x0    | reserved #0xff                 |
| 0x1    | Temperature #0xff              |
| 0x2    | Voltage #0xff                  |
| 0x3    | Current #0xff                  |
| 0x4    | Fan #0xff                      |
| 0x5    | Physical Security #0xff        |
| 0x6    | Platform Security #0xff        |
| 0x7    | Processor #0xff                |
| 0x8    | Power Supply #0xff             |
| 0x9    | Power Unit #0xff               |
| 0xa    | Cooling Device #0xff           |
| 0xb    | Other #0xff                    |
| 0xc    | Memory #0xff                   |
| 0xd    | Drive Slot / Bay #0xff         |
| 0xe    | POST Memory Resize #0xff       |
| 0xf    | System Firmwares #0xff         |
| 0x10   | Event Logging Disabled #0xff   |
| 0x11   | Watchdog1 #0xff                |
| 0x12   | System Event #0xff             |
| 0x13   | Critical Interrupt #0xff       |
| 0x14   | Button #0xff                   |
| 0x15   | Module / Board #0xff           |
| 0x16   | Microcontroller #0xff          |
| 0x17   | Add-in Card #0xff              |
| 0x18   | Chassis #0xff                  |
| 0x19   | Chip Set #0xff                 |
| 0x1a   | Other FRU #0xff                |
| 0x1b   | Cable / Interconnect #0xff     |
| 0x1c   | Terminator #0xff               |
| 0x1d   | System Boot Initiated #0xff    |
| 0x1e   | Boot Error #0xff               |
| 0x1f   | OS Boot #0xff                  |
| 0x20   | OS Critical Stop #0xff         |
| 0x21   | Slot / Connector #0xff         |
| 0x22   | System ACPI Power State #0xff  |
| 0x23   | Watchdog2 #0xff                |
| 0x24   | Platform Alert #0xff           |
| 0x25   | Entity Presence #0xff          |
| 0x26   | Monitor ASIC #0xff             |
| 0x27   | LAN #0xff                      |
| 0x28   | Management Subsys Health #0xff |
| 0x29   | Battery #0xff                  |
| 0x2a   | Session Audit #0xff            |
| 0x2b   | Version Change #0xff           |
| 0x2c   | FRU State #0xff                |
| 0x2d   | Unknown #0xff                  |
| 0x2e   | Unknown #0xff                  |

example:
```bash			================start================
#   1 | 02/01/2000 | 20:23:19 | reserved #0xff |  | Asserted
#-> 0xFF00 => 00 => reserved
#  14 | 02/01/2000 | 20:25:08 | Critical Interrupt #0xff | I/O Channel check NMI | Asserted
#-> 0XFF13 => 13 => Critical Interrupt
```

## event-data-1 ##
[back to decode raw data](#decode-ipmitool-sel-raw-data)
I find the document a bit difficult to understand.
Here, I have derived this based on the SCR and the results.
This field will affect the subcategories under the main category

筆者在這裡 雖然沒有很懂 但是從結果來推倒答案
我想是一個很簡單的事情
```bash			================start================
0x04 0x14 0xf0 0x6f 0x00 0x00 0x00 # Button #0xf0 Power Button pressed
0x04 0x14 0xf0 0x6f 0x01 0x00 0x00 # Button #0xf0 Sleep Button pressed
0x04 0x14 0xf0 0x6f 0x02 0x00 0x00 # Button #0xf0 Reset Button pressed
0x04 0x14 0xf0 0x6f 0x03 0x00 0x00 # Button #0xf0 FRU Latch
0x04 0x14 0xf0 0x6f 0x04 0x00 0x00 # Button #0xf0 FRU Service
0x04 0x14 0xf0 0x6f 0x05 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x06 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x07 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x08 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x09 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0a 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0b 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0c 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0d 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0e 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x0f 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x10 0x00 0x00 # Button #0xf0 Power Button pressed
0x04 0x14 0xf0 0x6f 0x11 0x00 0x00 # Button #0xf0 Sleep Button pressed
0x04 0x14 0xf0 0x6f 0x12 0x00 0x00 # Button #0xf0 Reset Button pressed
0x04 0x14 0xf0 0x6f 0x13 0x00 0x00 # Button #0xf0 FRU Latch
0x04 0x14 0xf0 0x6f 0x14 0x00 0x00 # Button #0xf0 FRU Service
0x04 0x14 0xf0 0x6f 0x15 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x16 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x17 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x18 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x19 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1a 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1b 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1c 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1d 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1e 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x1f 0x00 0x00 # Button #0xf0 Unknown
0x04 0x14 0xf0 0x6f 0x20 0x00 0x00 # Button #0xf0 Power Button pressed
```
因為實在太多筆者就只放部分 畢竟有規律的事情是最好掌握的
` /packages/common/packages/ipmitool-src/data/include/ipmitool/ipmi_sel.h`
```h			================start================
    /* Button */
    { 0x14, 0x00, 0xff, "Power Button pressed" },
    { 0x14, 0x01, 0xff, "Sleep Button pressed" },
    { 0x14, 0x02, 0xff, "Reset Button pressed" },
    { 0x14, 0x03, 0xff, "FRU Latch" },
    { 0x14, 0x04, 0xff, "FRU Service" },
```
file:` /packages/common/packages/libEventLogDes-src/data/libEventLogDes.c`
```c			================start================
/*Sensor Types*/
SenType_T Sen_Type [] =
{
    // 0 to 4 for 14h
    {0x14, 0x00, "Power Button pressed"},
    {0x14, 0x01, "Sleep Button pressed"},
    {0x14, 0x02, "Reset Button pressed"},
    {0x14, 0x03, "FRU latch open"},
    {0x14, 0x04, "FRU service request button"},
}
```
file: ` /packages/common/packages/SMASH_LITE-src/data/Source/SM_libipmi_interface.c`
```c			================start================
int getSELRecordData(SELEventRecord_T *ptrToSELRecord,char *propVal)
{
uint8 offset = 0;
offset = ptrToSELRecord->EvtData1 & 0x0f;
else if(ptrToSELRecord->SensorType == 0x14)
    {
#ifdef CONFIG_SPX_FEATURE_SMASH_LITE_SCORPIO
    snprintf(eventString,SENSOR_EVENT_STR_LEN,"%s    #%x ","Button/Switch",ptrToSELRecord->SensorNum);
#else
    strcat(eventString,"Button/Switch");
#endif
        if(offset == 0x00)
            strcat(eventString," - Power Button pressed");
        else if(offset == 0x01)
            strcat(eventString," - Sleep Button pressed");
        else if(offset == 0x02)
            strcat(eventString," - Reset Button pressed");
        else if(offset == 0x03)
            strcat(eventString," - FRU latch open");
        else if(offset == 0x04)
            strcat(eventString," - FRU service request button");
    }
}
```


###### record ######

```bash			================start================
~ #  ipmitool sel save /tmp/tem.txt
IOCTL to get IP failed: -1
  2c | 01/23/2000 | 04:12:27 | Voltage #0x65 | Lower Non-recoverable going low  | Asserted
  2d | 01/23/2000 | 04:12:27 | Voltage #0x66 | Lower Non-recoverable going low  | Asserted
  2e | 01/23/2000 | 04:12:37 | Fan #0x67 | Lower Non-recoverable going low  | Asserted
  2f | 01/23/2000 | 04:18:16 | Power Supply #0x60 |  | Asserted
   1 | 01/30/2000 | 00:13:29 | Fan #0x40 | Lower Non-recoverable going low  | Asserted
   2 | 01/30/2000 | 04:59:21 | Power Supply #0x60 |  | Asserted
   3 | 01/30/2000 | 04:59:21 | Power Supply #0x64 |  | Asserted
   4 | 01/30/2000 | 04:59:21 | Voltage #0x65 | Lower Non-recoverable going low  | Asserted
   5 | 01/30/2000 | 23:18:20 | Fan #0x40 | Lower Non-recoverable going low  | Asserted
```
```bash			================start================
~ #   cat /tmp/tem.txt
0x04 0x02 0x65 0x01 0x54 0x00 0x5a # Voltage #0x65 Lower Non-recoverable going low
0x04 0x02 0x66 0x01 0x54 0x00 0x58 # Voltage #0x66 Lower Non-recoverable going low
0x04 0x04 0x67 0x01 0x54 0x00 0x00 # Fan #0x67 Lower Non-recoverable going low
0x04 0x08 0x60 0x6f 0xa8 0x08 0x20 # Power Supply #0x60 Unknown
0x04 0x04 0x40 0x01 0x54 0x00 0x05 # Fan #0x40 Lower Non-recoverable going low
0x04 0x08 0x60 0x6f 0xa8 0x00 0x20 # Power Supply #0x60 Unknown
0x04 0x08 0x64 0x6f 0xa8 0x00 0x20 # Power Supply #0x64 Unknown
0x04 0x02 0x65 0x01 0x54 0x07 0x5a # Voltage #0x65 Lower Non-recoverable going low
0x04 0x04 0x40 0x01 0x54 0x00 0x05 # Fan #0x40 Lower Non-recoverable going low

0x04 : event revision
0x02 : sensor type  (Record Type)
0x65 : sensor number
0x01 : event DIR + event type (???)

```

| 0X00           | 0x11        | 0x22          | 0x33                 | 0x55   | 0x66 | 0x77 |
| event revision | sensor type | sensor number | event DIR+event type | data 1 |      |      |
